<Window
  x:Class="VentWPF.MainWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:ex="http://propertytools.org/wpf"
  xmlns:l="clr-namespace:VentWPF"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
  xmlns:t="clr-namespace:VentWPF.Tools"
  xmlns:vm="clr-namespace:VentWPF.ViewModel"
  Title="MainWindow"
  Width="1280"
  Height="720"
  Background="{DynamicResource MaterialDesignPaper}"
  FontFamily="{md:MaterialDesignFont}"
  TextElement.FontSize="14"
  TextElement.FontWeight="Medium"
  TextElement.Foreground="{DynamicResource MaterialDesignBody}"
  mc:Ignorable="d">
  <Window.DataContext>
    <vm:MainViewModel />
  </Window.DataContext>
  <Window.Resources>
    <!--  Ресурсы окна  -->
    <Style TargetType="{x:Type Image}">
      <Setter Property="RenderOptions.BitmapScalingMode" Value="HighQuality" />
    </Style>
    <Style x:Key="PopupMenu" TargetType="Popup">
      <Setter Property="Placement" Value="Relative" />
      <EventSetter Event="MouseLeave" Handler="MouseLeave" />
    </Style>
    <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="{x:Type Button}">
      <Setter Property="Width" Value="75" />
      <Setter Property="Height" Value="75" />
    </Style>

    <vm:Heater_Water x:Key="hw" />
    <vm:Heater_Gas x:Key="hg" />
    <vm:Heater_Electric x:Key="he" />

  </Window.Resources>
  <DockPanel>
    <Menu Height="25" DockPanel.Dock="Top">
      <MenuItem Height="25" Header="Файл" />
    </Menu>
    <StatusBar DockPanel.Dock="Bottom">
      <TextBlock Text="Статус" />
    </StatusBar>
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="5*" MinWidth="600" />
        <ColumnDefinition Width="2*" MinWidth="400" />
      </Grid.ColumnDefinitions>
      <GridSplitter
        Width="6"
        Margin="0,0,0,0"
        HorizontalAlignment="Right"
        Panel.ZIndex="2"
        Background="Transparent" />
      <DockPanel>
        <Rectangle
          Width="5"
          VerticalAlignment="Stretch"
          DockPanel.Dock="Right"
          Fill="{DynamicResource MaterialDesignDarkBackground}" />
        <!--  Верхняя панель для содания элементов  -->
        <md:Card Background="LightGray" DockPanel.Dock="Top">
          <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
            <UniformGrid
              Width="830"
              Height="90"
              HorizontalAlignment="Left"
              Columns="10">
              <UniformGrid.Resources>
                <Style BasedOn="{StaticResource MaterialDesignFlatButton}" TargetType="{x:Type Button}">
                  <Setter Property="Width" Value="75" />
                  <Setter Property="Height" Value="75" />
                </Style>
                <Style BasedOn="{x:Null}" TargetType="{x:Type Image}">
                  <Setter Property="Margin" Value="-16" />
                </Style>
                <!--  popups  -->
                <Popup x:Key="Heaters" Style="{StaticResource PopupMenu}">
                  <UniformGrid Background="{DynamicResource MaterialDesignLightBackground}">
                    <Button
                      Background="LightPink"
                      Command="{Binding AddElementCommand}"
                      CommandParameter="{StaticResource hw}">
                      <Image DataContext="{StaticResource hw}" Source="{Binding Image}" />
                    </Button>
                  </UniformGrid>
                </Popup>
                <!--  popups/  -->
              </UniformGrid.Resources>
              <Button>
                <Image Source="{Binding HeaderImages.Valves}" />
              </Button>
              <Button>
                <Image Source="{Binding HeaderImages.Filters}" />
              </Button>
              <Button Command="{Binding CmdOpenPopup}" CommandParameter="{DynamicResource Heaters}">
                <Image Source="{Binding HeaderImages.Heaters}" />
              </Button>
              <Button>
                <Image Source="{Binding HeaderImages.Coolers}" />
              </Button>
              <Button>
                <Image Source="{Binding HeaderImages.Empty}" />
              </Button>
              <Button
                Background="LightPink"
                Command="{Binding AddElementCommand}"
                CommandParameter="{StaticResource hw}">
                <Image DataContext="{StaticResource hw}" Source="{Binding Image}" />
              </Button>
              <Button
                Background="LightPink"
                Command="{Binding AddElementCommand}"
                CommandParameter="{StaticResource hw}">
                <Image DataContext="{StaticResource hw}" Source="{Binding Image}" />
              </Button>
              <Button>
                <Image Source="{Binding HeaderImages.Sections}" />
              </Button>
              <Button>
                <Image Source="{Binding HeaderImages.Filters}" />
              </Button>
              <!--  Заменить на увлажнитель  -->
              <Button
                Background="LightPink"
                Command="{Binding AddElementCommand}"
                CommandParameter="{StaticResource hw}">
                <Image DataContext="{StaticResource hw}" Source="{Binding Image}" />
              </Button>
              <!--  Для рекуператора  -->
              <Button Visibility="Collapsed">
                <Image Source="{Binding HeaderImages.Empty}" />
              </Button>





            </UniformGrid>
          </ScrollViewer>

        </md:Card>
        <!--  Нижняя панель для констурирования системы  -->
        <md:Card Background="LightGray" DockPanel.Dock="Bottom">
          <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
            <ListBox
              Width="750"
              Height="150"
              HorizontalAlignment="Left"
              ItemsSource="{Binding Table}"
              SelectedIndex="{Binding SelectedIndex}"
              SelectedItem="{Binding SelectedElement}">
              <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                  <UniformGrid Columns="10" Rows="2">
                    <UniformGrid.Style>
                      <Style TargetType="{x:Type UniformGrid}">
                        <Style.Triggers>
                          <DataTrigger Binding="{Binding CurrentProject.Rows}" Value="1">
                            <Setter Property="Rows" Value="1" />
                          </DataTrigger>
                        </Style.Triggers>
                      </Style>
                    </UniformGrid.Style>
                  </UniformGrid>
                </ItemsPanelTemplate>
              </ListBox.ItemsPanel>
              <ListBox.ItemTemplate>
                <DataTemplate DataType="ElementVM">
                  <Image
                    Margin="-6"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Source="{Binding Image}" />
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </ScrollViewer>
        </md:Card>
        <Rectangle
          Height="5"
          HorizontalAlignment="Stretch"
          DockPanel.Dock="Bottom"
          Fill="{DynamicResource MaterialDesignDarkBackground}" />
        <Rectangle
          Height="5"
          HorizontalAlignment="Stretch"
          DockPanel.Dock="Top"
          Fill="{DynamicResource MaterialDesignDarkBackground}" />
        <!--  Основная панель  -->
        <TabControl Margin="0,2,0,0">
          <TabItem Header="Проект">
            <ex:PropertyGrid
              Width="400"
              SelectedObject="{Binding CurrentProject}"
              TabVisibility="Collapsed" />
          </TabItem>
          <TabItem Header="Подбор" />
          <TabItem Header="Графики" />
          <TabItem Header="Схема" />
          <TabItem Header="Отчёт" />
          <TabItem Header="Электроника" />
          <TabItem Header="3D" />
        </TabControl>
      </DockPanel>
      <ScrollViewer Grid.Column="1">
        <Grid Margin="7,2,0,0">
          <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
          </Grid.RowDefinitions>
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="auto" />
              <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Image
              Width="50"
              Height="50"
              Source="{Binding SelectedElement.Image}" />
            <TextBlock
              Grid.Column="1"
              Margin="4,0"
              VerticalAlignment="Bottom"
              Style="{DynamicResource MaterialDesignHeadline6TextBlock}"
              Text="{Binding SelectedElement.Name}"
              TextWrapping="WrapWithOverflow" />
          </Grid>
          <ex:PropertyGrid
            Grid.Row="1"
            SelectedObject="{Binding SelectedElement}"
            TabVisibility="Collapsed" />
          <DataGrid
            x:Name="dg"
            Grid.Row="2"
            Height="500"
            AutoGenerateColumns="True"
            Background="LightBlue"
            ItemsSource="{Binding SelectedElement.Query}">
            <DataGrid.Style>
              <Style BasedOn="{StaticResource {x:Type DataGrid}}" TargetType="{x:Type DataGrid}">
                <Setter Property="Visibility" Value="Visible" />
                <Style.Triggers>
                  <DataTrigger Binding="{Binding Items.Count, ElementName=dg}" Value="0">
                    <Setter Property="Visibility" Value="Collapsed" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </DataGrid.Style>
          </DataGrid>

        </Grid>
      </ScrollViewer>

    </Grid>
  </DockPanel>
</Window>
